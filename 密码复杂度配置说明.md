# å¯†ç å¤æ‚åº¦éªŒè¯é…ç½®è¯´æ˜

## åŠŸèƒ½æ¦‚è¿°

ä» v0.1.2 å¼€å§‹ï¼Œå¯†ç å¤æ‚åº¦éªŒè¯å·²æ”¹ä¸º**å¯é…ç½®é€‰é¡¹**ï¼Œç®¡ç†å‘˜å¯ä»¥æ ¹æ®å®é™…éœ€æ±‚é€‰æ‹©å¯ç”¨æˆ–ç¦ç”¨ã€‚

---

## é…ç½®ä½ç½®

**è·¯å¾„**ï¼šTypecho åå° â†’ æ§åˆ¶å° â†’ æ’ä»¶ â†’ Passport â†’ è®¾ç½®

**é…ç½®é¡¹**ï¼šæ‰¾å›å¯†ç é«˜çº§é…ç½® â†’ **å¯†ç å¤æ‚åº¦éªŒè¯**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ å¯†ç å¤æ‚åº¦éªŒè¯                               â”‚
â”‚ â—‹ å¯ç”¨  â—‹ ç¦ç”¨                              â”‚
â”‚                                              â”‚
â”‚ æ¨èï¼šå¯ç”¨åè¦æ±‚å¯†ç è‡³å°‘ 8 ä½ï¼ŒåŒ…å«å¤§å°å†™   â”‚
â”‚ å­—æ¯ã€æ•°å­—å’Œç‰¹æ®Šå­—ç¬¦ã€‚ç¦ç”¨åä»…è¦æ±‚å¯†ç ä¸ä¸ºç©ºã€‚â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ä¸¤ç§æ¨¡å¼å¯¹æ¯”

### ğŸ”’ å¯ç”¨æ¨¡å¼ï¼ˆé»˜è®¤ï¼Œæ¨èï¼‰

**å¯†ç è¦æ±‚**ï¼š
- âœ… è‡³å°‘ 8 ä½
- âœ… è‡³å°‘ 1 ä¸ªå¤§å†™å­—æ¯ï¼ˆA-Zï¼‰
- âœ… è‡³å°‘ 1 ä¸ªå°å†™å­—æ¯ï¼ˆa-zï¼‰
- âœ… è‡³å°‘ 1 ä¸ªæ•°å­—ï¼ˆ0-9ï¼‰
- âœ… è‡³å°‘ 1 ä¸ªç‰¹æ®Šå­—ç¬¦ï¼ˆå¦‚ !@#$%^&*ï¼‰

**ç¤ºä¾‹**ï¼š
- âœ… `MyP@ssw0rd` - é€šè¿‡
- âœ… `Secure123!` - é€šè¿‡
- âŒ `password` - å¤±è´¥ï¼ˆç¼ºå°‘å¤§å†™ã€æ•°å­—ã€ç‰¹æ®Šå­—ç¬¦ï¼‰
- âŒ `PASSWORD123` - å¤±è´¥ï¼ˆç¼ºå°‘å°å†™ã€ç‰¹æ®Šå­—ç¬¦ï¼‰
- âŒ `Pass123` - å¤±è´¥ï¼ˆå°‘äº 8 ä½ï¼Œç¼ºå°‘ç‰¹æ®Šå­—ç¬¦ï¼‰

**ä¼˜ç‚¹**ï¼š
- ğŸ›¡ï¸ é«˜å®‰å…¨æ€§ï¼Œé˜²æ­¢å¼±å¯†ç 
- ğŸ›¡ï¸ ç¬¦åˆå®‰å…¨æœ€ä½³å®è·µ
- ğŸ›¡ï¸ é™ä½æš´åŠ›ç ´è§£é£é™©

**ç¼ºç‚¹**ï¼š
- âš ï¸ ç”¨æˆ·ä½“éªŒç¨å·®ï¼ˆéœ€è¦è®°ä½å¤æ‚å¯†ç ï¼‰
- âš ï¸ å¯èƒ½å¯¼è‡´ç”¨æˆ·ä½¿ç”¨å¯†ç ç®¡ç†å™¨æˆ–å†™ä¸‹å¯†ç 

---

### ğŸ”“ ç¦ç”¨æ¨¡å¼

**å¯†ç è¦æ±‚**ï¼š
- âœ… ä¸ä¸ºç©ºå³å¯

**ç¤ºä¾‹**ï¼š
- âœ… `123456` - é€šè¿‡
- âœ… `password` - é€šè¿‡
- âœ… `abc` - é€šè¿‡
- âŒ `ï¼ˆç©ºï¼‰` - å¤±è´¥

**ä¼˜ç‚¹**ï¼š
- âœ… ç”¨æˆ·ä½“éªŒå¥½ï¼Œæ˜“äºè®°å¿†
- âœ… é€‚åˆå†…ç½‘æˆ–ä½é£é™©ç¯å¢ƒ

**ç¼ºç‚¹**ï¼š
- âš ï¸ å®‰å…¨æ€§ä½ï¼Œå®¹æ˜“è¢«æš´åŠ›ç ´è§£
- âš ï¸ ç”¨æˆ·å¯èƒ½è®¾ç½®å¼±å¯†ç 

---

## ä½¿ç”¨å»ºè®®

### æ¨èå¯ç”¨çš„åœºæ™¯
- ğŸŒ **å…¬ç½‘ç¯å¢ƒ**ï¼šç½‘ç«™å¯ä»äº’è”ç½‘è®¿é—®
- ğŸ‘¥ **å¤šç”¨æˆ·ç¯å¢ƒ**ï¼šæœ‰å¤šä¸ªç”¨æˆ·è´¦æˆ·
- ğŸ” **æ•æ„Ÿæ•°æ®**ï¼šç½‘ç«™åŒ…å«æ•æ„Ÿä¿¡æ¯
- ğŸ’¼ **ä¼ä¸šç¯å¢ƒ**ï¼šéœ€è¦ç¬¦åˆå®‰å…¨åˆè§„è¦æ±‚

### å¯ä»¥ç¦ç”¨çš„åœºæ™¯
- ğŸ  **å†…ç½‘ç¯å¢ƒ**ï¼šä»…å†…éƒ¨ç½‘ç»œè®¿é—®
- ğŸ‘¤ **å•ç”¨æˆ·ç¯å¢ƒ**ï¼šåªæœ‰ç®¡ç†å‘˜ä¸€ä¸ªè´¦æˆ·
- ğŸ§ª **æµ‹è¯•ç¯å¢ƒ**ï¼šå¼€å‘æˆ–æµ‹è¯•ç”¨é€”
- ğŸ“ **ä¸ªäººåšå®¢**ï¼šä½é£é™©çš„ä¸ªäººç½‘ç«™

---

## é…ç½®æ­¥éª¤

### æ–¹æ³• 1ï¼šé€šè¿‡åå°é…ç½®ï¼ˆæ¨èï¼‰

1. ç™»å½• Typecho åå°
2. è¿›å…¥ **æ§åˆ¶å°** â†’ **æ’ä»¶**
3. æ‰¾åˆ° **Passport** æ’ä»¶ï¼Œç‚¹å‡» **è®¾ç½®**
4. æ‰¾åˆ° **å¯†ç å¤æ‚åº¦éªŒè¯** é€‰é¡¹
5. é€‰æ‹© **å¯ç”¨** æˆ– **ç¦ç”¨**
6. ç‚¹å‡» **ä¿å­˜è®¾ç½®**

### æ–¹æ³• 2ï¼šç›´æ¥ä¿®æ”¹æ•°æ®åº“

```sql
-- å¯ç”¨å¯†ç å¤æ‚åº¦éªŒè¯
UPDATE typecho_options
SET value = '1'
WHERE name = 'plugin:Passport:enablePasswordComplexity';

-- ç¦ç”¨å¯†ç å¤æ‚åº¦éªŒè¯
UPDATE typecho_options
SET value = '0'
WHERE name = 'plugin:Passport:enablePasswordComplexity';
```

---

## æŠ€æœ¯å®ç°

### é…ç½®é¡¹å®šä¹‰

**æ–‡ä»¶**ï¼š`Plugin.php` ç¬¬ 149-150 è¡Œ

```php
$enablePasswordComplexity = new Typecho_Widget_Helper_Form_Element_Radio(
    'enablePasswordComplexity',
    ['1' => _t('å¯ç”¨'), '0' => _t('ç¦ç”¨')],
    '1',  // é»˜è®¤å¯ç”¨
    _t('å¯†ç å¤æ‚åº¦éªŒè¯'),
    _t('æ¨èï¼šå¯ç”¨åè¦æ±‚å¯†ç è‡³å°‘ 8 ä½ï¼ŒåŒ…å«å¤§å°å†™å­—æ¯ã€æ•°å­—å’Œç‰¹æ®Šå­—ç¬¦ã€‚')
);
```

### éªŒè¯é€»è¾‘

**æ–‡ä»¶**ï¼š`Widget.php` ç¬¬ 308-314 è¡Œ

```php
// æ£€æŸ¥é…ç½®æ˜¯å¦å¯ç”¨
if (!empty($this->config->enablePasswordComplexity)
    && $this->config->enablePasswordComplexity == '1') {
    // æ‰§è¡Œå¤æ‚åº¦éªŒè¯
    if (($complexityError = $this->validatePasswordComplexity($this->request->password)) !== true) {
        $this->_setNotice($complexityError, 'error');
        return;
    }
}
```

### éªŒè¯è§„åˆ™

**æ–‡ä»¶**ï¼š`Widget.php` ç¬¬ 342-364 è¡Œ

```php
private function validatePasswordComplexity($password) {
    $errors = [];
    if (strlen($password) < 8) {
        $errors[] = _t('å¯†ç é•¿åº¦ä¸èƒ½å°‘äº8ä½');
    }
    if (!preg_match('/[A-Z]/', $password)) {
        $errors[] = _t('å¯†ç å¿…é¡»åŒ…å«è‡³å°‘ä¸€ä¸ªå¤§å†™å­—æ¯');
    }
    if (!preg_match('/[a-z]/', $password)) {
        $errors[] = _t('å¯†ç å¿…é¡»åŒ…å«è‡³å°‘ä¸€ä¸ªå°å†™å­—æ¯');
    }
    if (!preg_match('/[0-9]/', $password)) {
        $errors[] = _t('å¯†ç å¿…é¡»åŒ…å«è‡³å°‘ä¸€ä¸ªæ•°å­—');
    }
    if (!preg_match('/[\W_]/', $password)) {
        $errors[] = _t('å¯†ç å¿…é¡»åŒ…å«è‡³å°‘ä¸€ä¸ªç‰¹æ®Šå­—ç¬¦');
    }

    if (empty($errors)) {
        return true;
    }
    return implode('ï¼›', $errors) . 'ã€‚';
}
```

---

## å¸¸è§é—®é¢˜

### Q1: ç¦ç”¨åè¿˜æœ‰å…¶ä»–å¯†ç éªŒè¯å—ï¼Ÿ

**A:** æœ‰çš„ï¼ŒTypecho è¡¨å•éªŒè¯ä»ç„¶ä¼šæ£€æŸ¥ï¼š
- å¯†ç ä¸ä¸ºç©º
- ä¸¤æ¬¡è¾“å…¥çš„å¯†ç ä¸€è‡´

### Q2: ä¿®æ”¹é…ç½®åéœ€è¦é‡å¯å—ï¼Ÿ

**A:** ä¸éœ€è¦ï¼Œä¿å­˜é…ç½®åç«‹å³ç”Ÿæ•ˆã€‚

### Q3: å·²æœ‰ç”¨æˆ·çš„å¯†ç ä¼šå—å½±å“å—ï¼Ÿ

**A:** ä¸ä¼šï¼Œè¿™ä¸ªé…ç½®åªå½±å“**é‡ç½®å¯†ç **æ—¶çš„éªŒè¯ï¼Œä¸å½±å“å·²æœ‰å¯†ç ã€‚

### Q4: å¯ä»¥è‡ªå®šä¹‰éªŒè¯è§„åˆ™å—ï¼Ÿ

**A:** ç›®å‰ä¸æ”¯æŒè‡ªå®šä¹‰è§„åˆ™ï¼Œåªèƒ½é€‰æ‹©å¯ç”¨æˆ–ç¦ç”¨ã€‚å¦‚éœ€è‡ªå®šä¹‰ï¼Œéœ€è¦ä¿®æ”¹ `validatePasswordComplexity()` æ–¹æ³•ã€‚

### Q5: ç¦ç”¨åå®‰å…¨æ€§å¦‚ä½•ä¿è¯ï¼Ÿ

**A:** å»ºè®®é…åˆä»¥ä¸‹æªæ–½ï¼š
- âœ… å¯ç”¨é€Ÿç‡é™åˆ¶ï¼ˆé˜²æ­¢æš´åŠ›ç ´è§£ï¼‰
- âœ… å¯ç”¨éªŒè¯ç ï¼ˆé˜²æ­¢è‡ªåŠ¨åŒ–æ”»å‡»ï¼‰
- âœ… å®šæœŸæé†’ç”¨æˆ·ä¿®æ”¹å¯†ç 
- âœ… ç›‘æ§å¼‚å¸¸ç™»å½•è¡Œä¸º

---

## å®‰å…¨å»ºè®®

### ğŸ”’ é«˜å®‰å…¨æ€§é…ç½®ï¼ˆæ¨èï¼‰

```
å¯†ç å¤æ‚åº¦éªŒè¯ï¼šå¯ç”¨
è¯·æ±‚é€Ÿç‡é™åˆ¶ï¼šå¯ç”¨
éªŒè¯ç ç±»å‹ï¼šreCAPTCHA æˆ– hCaptcha
HMAC å¯†é’¥ï¼šå·²è®¾ç½®
```

### âš–ï¸ å¹³è¡¡é…ç½®

```
å¯†ç å¤æ‚åº¦éªŒè¯ï¼šå¯ç”¨
è¯·æ±‚é€Ÿç‡é™åˆ¶ï¼šå¯ç”¨
éªŒè¯ç ç±»å‹ï¼šä¸ä½¿ç”¨
HMAC å¯†é’¥ï¼šå·²è®¾ç½®
```

### ğŸ”“ ä½å®‰å…¨æ€§é…ç½®ï¼ˆä»…å†…ç½‘ï¼‰

```
å¯†ç å¤æ‚åº¦éªŒè¯ï¼šç¦ç”¨
è¯·æ±‚é€Ÿç‡é™åˆ¶ï¼šç¦ç”¨
éªŒè¯ç ç±»å‹ï¼šä¸ä½¿ç”¨
HMAC å¯†é’¥ï¼šç•™ç©º
```

---

## æ›´æ–°æ—¥å¿—

- **v0.1.2**ï¼šæ–°å¢å¯†ç å¤æ‚åº¦éªŒè¯é…ç½®é€‰é¡¹
- **v0.1.1-pre**ï¼šå¯†ç å¤æ‚åº¦éªŒè¯ä¸ºå¼ºåˆ¶å¯ç”¨

---

## æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·è®¿é—®ï¼š
- **GitHub Issues**: https://github.com/little-gt/PLUGION-Passport/issues
- **æ–‡æ¡£**: [SECURITY-FIX-v0.1.2.md](./SECURITY-FIX-v0.1.2.md)
